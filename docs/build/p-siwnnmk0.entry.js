import{r as t,h as n,H as r,g as e}from"./p-9f6cb62c.js";const s=class{constructor(n){t(this,n)}render(){return n(r,null,n("div",{class:"ct-actions__emoji"},n("ct-button",{small:!0},"+ Emoji")),n("div",{class:"ct-actions__controls"},n("a",null,"Reply"),n("span",null,"·"),n("a",null,"Share")))}static get style(){return":host{display:block;margin-top:1rem}"}};function i(t,n){return t(n={exports:{}},n.exports),n.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var u=i((function(t){
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/
!function(){var n={}.hasOwnProperty;function r(){for(var t=[],e=0;e<arguments.length;e++){var s=arguments[e];if(s){var i=typeof s;if("string"===i||"number"===i)t.push(s);else if(Array.isArray(s)&&s.length){var u=r.apply(null,s);u&&t.push(u)}else if("object"===i)for(var a in s)n.call(s,a)&&s[a]&&t.push(a)}}return t.join(" ")}t.exports?(r.default=r,t.exports=r):window.classNames=r}()}));const a=class{constructor(n){t(this,n),this.nested=!1}render(){return n("div",{class:u("ct-comment__avatar",{"ct-comment__avatar--nested":this.nested})},n("img",this.user?{src:this.user.picture_url,alt:`${this.user.name}'s Avatar`}:{src:e("./assets/fallback.jpg"),alt:"No avatar"}))}static get assetsDirs(){return["assets"]}static get style(){return":host{width:3.5rem;height:3.5rem}:host img{width:100%;height:100%;border-radius:50%}.ct-comment__avatar--nested{width:2.5rem;height:2.5rem}"}},c=class{constructor(n){t(this,n),this.small=!1}render(){return n(r,{class:u("ct-button",{"ct-button--small":this.small})},n("slot",null))}static get style(){return":host{display:-ms-inline-flexbox;display:inline-flex;padding:1rem 1.75rem;background-color:#0d2031;margin-top:1rem;color:#00d664;font-size:.875rem;cursor:pointer}:host.ct-button--small{padding:0}"}};var h=i((function(t){t.exports=function(){var t="millisecond",n="second",r="minute",e="hour",s="day",i="week",u="month",a="quarter",c="year",h=/^(\d{4})-?(\d{1,2})-?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?.?(\d{1,3})?$/,o=/\[([^\]]+)]|Y{2,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,l=function(t,n,r){var e=String(t);return!e||e.length>=n?t:""+Array(n+1-e.length).join(r)+t},f={s:l,z:function(t){var n=-t.utcOffset(),r=Math.abs(n),e=Math.floor(r/60),s=r%60;return(n<=0?"+":"-")+l(e,2,"0")+":"+l(s,2,"0")},m:function(t,n){var r=12*(n.year()-t.year())+(n.month()-t.month()),e=t.clone().add(r,u),s=n-e<0,i=t.clone().add(r+(s?-1:1),u);return Number(-(r+(n-e)/(s?e-i:i-e))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(h){return{M:u,y:c,w:i,d:s,h:e,m:r,s:n,ms:t,Q:a}[h]||String(h||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},d={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},m="en",v={};v[m]=d;var y=function(t){return t instanceof b},_=function(t,n,r){var e;if(!t)return m;if("string"==typeof t)v[t]&&(e=t),n&&(v[t]=n,e=t);else{var s=t.name;v[s]=t,e=s}return r||(m=e),e},M=function(t,n,r){if(y(t))return t.clone();var e=n?"string"==typeof n?{format:n,pl:r}:n:{};return e.date=t,new b(e)},g=f;g.l=_,g.i=y,g.w=function(t,n){return M(t,{locale:n.$L,utc:n.$u,$offset:n.$offset})};var b=function(){function l(t){this.$L=this.$L||_(t.locale,null,!0),this.parse(t)}var f=l.prototype;return f.parse=function(t){this.$d=function(t){var n=t.date,r=t.utc;if(null===n)return new Date(NaN);if(g.u(n))return new Date;if(n instanceof Date)return new Date(n);if("string"==typeof n&&!/Z$/i.test(n)){var e=n.match(h);if(e)return r?new Date(Date.UTC(e[1],e[2]-1,e[3]||1,e[4]||0,e[5]||0,e[6]||0,e[7]||0)):new Date(e[1],e[2]-1,e[3]||1,e[4]||0,e[5]||0,e[6]||0,e[7]||0)}return new Date(n)}(t),this.init()},f.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},f.$utils=function(){return g},f.isValid=function(){return!("Invalid Date"===this.$d.toString())},f.isSame=function(t,n){var r=M(t);return this.startOf(n)<=r&&r<=this.endOf(n)},f.isAfter=function(t,n){return M(t)<this.startOf(n)},f.isBefore=function(t,n){return this.endOf(n)<M(t)},f.$g=function(t,n,r){return g.u(t)?this[n]:this.set(r,t)},f.year=function(t){return this.$g(t,"$y",c)},f.month=function(t){return this.$g(t,"$M",u)},f.day=function(t){return this.$g(t,"$W",s)},f.date=function(t){return this.$g(t,"$D","date")},f.hour=function(t){return this.$g(t,"$H",e)},f.minute=function(t){return this.$g(t,"$m",r)},f.second=function(t){return this.$g(t,"$s",n)},f.millisecond=function(n){return this.$g(n,"$ms",t)},f.unix=function(){return Math.floor(this.valueOf()/1e3)},f.valueOf=function(){return this.$d.getTime()},f.startOf=function(t,a){var h=this,o=!!g.u(a)||a,l=g.p(t),f=function(t,n){var r=g.w(h.$u?Date.UTC(h.$y,n,t):new Date(h.$y,n,t),h);return o?r:r.endOf(s)},d=function(t,n){return g.w(h.toDate()[t].apply(h.toDate(),(o?[0,0,0,0]:[23,59,59,999]).slice(n)),h)},m=this.$W,v=this.$M,y=this.$D,_="set"+(this.$u?"UTC":"");switch(l){case c:return o?f(1,0):f(31,11);case u:return o?f(1,v):f(0,v+1);case i:var M=this.$locale().weekStart||0,b=(m<M?m+7:m)-M;return f(o?y-b:y+(6-b),v);case s:case"date":return d(_+"Hours",0);case e:return d(_+"Minutes",1);case r:return d(_+"Seconds",2);case n:return d(_+"Milliseconds",3);default:return this.clone()}},f.endOf=function(t){return this.startOf(t,!1)},f.$set=function(i,a){var h,o=g.p(i),l="set"+(this.$u?"UTC":""),f=(h={},h[s]=l+"Date",h.date=l+"Date",h[u]=l+"Month",h[c]=l+"FullYear",h[e]=l+"Hours",h[r]=l+"Minutes",h[n]=l+"Seconds",h[t]=l+"Milliseconds",h)[o],d=o===s?this.$D+(a-this.$W):a;if(o===u||o===c){var m=this.clone().set("date",1);m.$d[f](d),m.init(),this.$d=m.set("date",Math.min(this.$D,m.daysInMonth())).toDate()}else f&&this.$d[f](d);return this.init(),this},f.set=function(t,n){return this.clone().$set(t,n)},f.get=function(t){return this[g.p(t)]()},f.add=function(t,a){var h,o=this;t=Number(t);var l=g.p(a),f=function(n){var r=M(o);return g.w(r.date(r.date()+Math.round(n*t)),o)};if(l===u)return this.set(u,this.$M+t);if(l===c)return this.set(c,this.$y+t);if(l===s)return f(1);if(l===i)return f(7);var d=(h={},h[r]=6e4,h[e]=36e5,h[n]=1e3,h)[l]||1,m=this.$d.getTime()+t*d;return g.w(m,this)},f.subtract=function(t,n){return this.add(-1*t,n)},f.format=function(t){var n=this;if(!this.isValid())return"Invalid Date";var r=t||"YYYY-MM-DDTHH:mm:ssZ",e=g.z(this),s=this.$locale(),i=this.$H,u=this.$m,a=this.$M,c=s.weekdays,h=s.months,l=function(t,e,s,i){return t&&(t[e]||t(n,r))||s[e].substr(0,i)},f=function(t){return g.s(i%12||12,t,"0")},d=s.meridiem||function(t,n,r){var e=t<12?"AM":"PM";return r?e.toLowerCase():e},m={YY:String(this.$y).slice(-2),YYYY:this.$y,M:a+1,MM:g.s(a+1,2,"0"),MMM:l(s.monthsShort,a,h,3),MMMM:h[a]||h(this,r),D:this.$D,DD:g.s(this.$D,2,"0"),d:String(this.$W),dd:l(s.weekdaysMin,this.$W,c,2),ddd:l(s.weekdaysShort,this.$W,c,3),dddd:c[this.$W],H:String(i),HH:g.s(i,2,"0"),h:f(1),hh:f(2),a:d(i,u,!0),A:d(i,u,!1),m:String(u),mm:g.s(u,2,"0"),s:String(this.$s),ss:g.s(this.$s,2,"0"),SSS:g.s(this.$ms,3,"0"),Z:e};return r.replace(o,(function(t,n){return n||m[t]||e.replace(":","")}))},f.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},f.diff=function(t,h,o){var l,f=g.p(h),d=M(t),m=6e4*(d.utcOffset()-this.utcOffset()),v=this-d,y=g.m(this,d);return y=(l={},l[c]=y/12,l[u]=y,l[a]=y/3,l[i]=(v-m)/6048e5,l[s]=(v-m)/864e5,l[e]=v/36e5,l[r]=v/6e4,l[n]=v/1e3,l)[f]||v,o?y:g.a(y)},f.daysInMonth=function(){return this.endOf(u).$D},f.$locale=function(){return v[this.$L]},f.locale=function(t,n){if(!t)return this.$L;var r=this.clone();return r.$L=_(t,n,!0),r},f.clone=function(){return g.w(this.$d,this)},f.toDate=function(){return new Date(this.valueOf())},f.toJSON=function(){return this.isValid()?this.toISOString():null},f.toISOString=function(){return this.$d.toISOString()},f.toString=function(){return this.$d.toUTCString()},l}();return M.prototype=b.prototype,M.extend=function(t,n){return t(n,b,M),M},M.locale=_,M.isDayjs=y,M.unix=function(t){return M(1e3*t)},M.en=v[m],M.Ls=v,M}()})),o=i((function(t){t.exports=function(t,n,r){var e=n.prototype;r.en.relativeTime={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};var s=function(t,n,e,s){for(var i,u,a=e.$locale().relativeTime,c=[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],h=c.length,o=0;o<h;o+=1){var l=c[o];l.d&&(i=s?r(t).diff(e,l.d,!0):e.diff(t,l.d,!0));var f=Math.round(Math.abs(i));if(f<=l.r||!l.r){1===f&&o>0&&(l=c[o-1]),u=a[l.l].replace("%d",f);break}}return n?u:(i>0?a.future:a.past).replace("%s",u)};e.to=function(t,n){return s(t,n,this,!0)},e.from=function(t,n){return s(t,n,this)};var i=function(t){return t.$u?r.utc():r()};e.toNow=function(t){return this.to(i(this),t)},e.fromNow=function(t){return this.from(i(this),t)}}}));h.extend(o);const l=class{constructor(n){t(this,n),this.nested=!1,this.areRepliesVisible=!1,this.isDeleted=!(this.comment.user&&this.comment.user.name.length),this.hasReplies=this.comment.replies.length>0}toggleReplies(){this.areRepliesVisible=!this.areRepliesVisible}getUserName(){return this.isDeleted?"Comment deleted":this.comment.user&&this.comment.user.name}getDate(){return this.comment&&h(this.comment.created_at)}getCreatedFromNowDate(){return this.getDate().fromNow()}getFullDate(){return this.getDate().toString()}render(){return console.log(this.comment),n(r,null,n("div",{class:"ct-comment"},n("ct-avatar",{user:this.comment.user,nested:this.nested}),n("div",{class:u("ct-comment__content",{"ct-comment__content--nested":this.nested})},n("div",{class:"content-meta"},n("div",{class:u("name",{"name--deleted":this.isDeleted})},this.getUserName()),n("div",{class:"separator"},"·"),n("div",{class:"date"},n("abbr",{title:this.getFullDate()},this.getCreatedFromNowDate()))),n("div",{class:"content-body"},this.comment.body),n("ct-actions",null),this.hasReplies&&!this.nested&&n("ct-button",{onClick:()=>this.toggleReplies()},"Show replies"))),n("div",{class:u("ct-replies",{"ct-replies--visible":this.nested||this.areRepliesVisible})},this.comment.replies.map(t=>n("ct-comment",{comment:t,nested:!0}))))}static get style(){return":host{display:block}abbr{text-decoration:none}.ct-comment{display:-ms-flexbox;display:flex;min-height:5.5rem;padding:1rem}.ct-comment__content{margin-left:1rem}.ct-comment__content--nested{margin-left:.25rem}.ct-comment__content .content-meta{display:-ms-flexbox;display:flex;font-size:.875rem}.ct-comment__content .content-meta .name{font-weight:700;color:#00d664;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.ct-comment__content .content-meta .name.name--deleted{color:#fff}.ct-comment__content .content-meta .date,.ct-comment__content .content-meta .separator{margin-left:.5rem}.ct-comment__content .content-body{margin-top:.75rem;font-size:1rem}.ct-replies{margin-left:1.75rem;position:relative;display:none}.ct-replies--visible{display:block}"}},f=(()=>{let t=new Map,r={currentUser:{id:null,auth_token:null,email:null,name:null,picture_url:null},comments:[]};const e=(t,n)=>{Array.isArray(t)?[...t].forEach(t=>{n[t]=r[t]}):n[t]=Object.assign({},r)},s=(n,r)=>(t.has(n)||(t.set(n,r),e(r,n)),()=>{t.has(n)&&t.delete(n)});return{Provider:({state:n},s)=>(r=n,t.forEach(e),s),Consumer:(t,r)=>((t,r)=>n("context-consumer",{subscribe:t,renderer:r}))(s,r[0]),injectProps:(n,r)=>{const e=n.prototype,i=e.connectedCallback,u=e.disconnectedCallback;e.connectedCallback=function(){if(s(this,r),i)return i.call(this)},e.disconnectedCallback=function(){t.delete(this),u&&u.call(this)}}}})(),d={fetch:async(t,n)=>(await fetch(t,Object.assign(Object.assign({},n),{headers:{"Content-Type":"application/json"}}))).json(),auth(t,n){if(n)return this.fetch(`${t}/auth`,{method:"post",body:JSON.stringify({id_token:n})})},fetchComments(t,n,r){return this.fetch(`${t}/${(t=>`/commentable/${t}/comments/list`)(n)}`,{method:"post",body:JSON.stringify(r)})}},m=class{constructor(n){t(this,n),this.currentUser={},this.comments=[],this.isLoading=!0,this.setCurrentUser=t=>{this.currentUser=t},this.setComments=t=>{this.comments=t}}async tokenWatchHandler(t){const n=await d.auth(this.apiUrl,t);this.setCurrentUser(n)}async currentUserWatchHandler(){const t={};this.currentUser&&(t.auth_token=this.currentUser.auth_token);const{comments:n}=await d.fetchComments(this.apiUrl,this.commentableId,t);this.setComments(n.reverse()),this.isLoading=!1}render(){return n(f.Provider,{state:{currentUser:this.currentUser,comments:this.comments}},this.isLoading?n("p",null,"Loading"):this.comments.map(t=>n("ct-comment",{comment:t})))}static get watchers(){return{googleIdToken:["tokenWatchHandler"],currentUser:["currentUserWatchHandler"]}}static get style(){return"\@import url(\"https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap\");:host{display:block;max-width:48rem;font-family:Open Sans,sans-serif;background-color:#0a1826;color:#f6f6f6}"}};export{s as ct_actions,a as ct_avatar,c as ct_button,l as ct_comment,m as ct_commentable};